#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#define NUMBERS_TO_SEND 5

void fils(int p_f[2],int f_p[2]) {
    close(p_f[1]);// Fermeture du tube en ecriture
    close(f_p[0]);// Fermeture du tube en ecriture


    int received_number;
    for (int i = 0; i < NUMBERS_TO_SEND; ++i) {
        read(p_f[0], &received_number, sizeof(int));
       
        write(f_p[1], &received_number, sizeof(int));

    }

    close(p_f[0]);// Fermeture du tube en ecriture
    close(f_p[0]);// Fermeture du tube en ecritur
    printf("Fils : Termination du processus fils avec succès\n");
    exit(EXIT_SUCCESS);
}

int main() {
    int pid_fils;
    int tube[2];

    if (pipe(tube) == -1) {
        perror("Erreur lors de la création du tube");
        exit(EXIT_FAILURE);
    }

    pid_fils = fork();
    if (pid_fils == -1) {
        perror("Erreur lors de la création du processus fils");
        exit(EXIT_FAILURE);
    }

    if (pid_fils == 0) {
        fils(tube);
    } else {
        close(tube[0]);//fermeture du tube en lecture 

        int numbers[NUMBERS_TO_SEND] = {1, 2, 3, 4, 5};
        for (int i = 0; i < NUMBERS_TO_SEND; ++i) {
            printf("Père : Envoi de l'entier %d au fils\n", numbers[i]);
            write(tube[1], &numbers[i], sizeof(int));
        }
        close(tube[1]);// fermeture du tube en ecriture
        wait(NULL);//entente jusqu'à ce le fils termine;
        printf("Père : Termination du processus père\n");
    }
    return 0;
}
