#include <stdio.h>
#include <stdlib.h>
#include<unistd.h>
#include <signal.h>


#define T 2 
int compteur=0;


void traitement (int n);
int main(void){
    int i, Pid, Tab[3];
    int status;
    if(signal(SIGUSR1, traitement)==SIG_ERR){
        perror("Erreur lors du traitement du signal");
        exit(EXIT_FAILURE);
    }

    for(int i=0;i<3; i++){
        if((Pid=fork())==0){
            while(1) compteur++;
        }

        Tab[i]=Pid;
    }

    while(1){

        printf("Attente avant envoi du signal");
        sleep(T);
        compteur ++;

        for(int i=0;i<3;i++){
            if((kill(Tab[i],SIGUSR1))==-1){
                perror("Erreur lors de l'envoi du signa");
                exit(EXIT_FAILURE);
            }
        }

        if(waitpid(Tab[0],&status, 1)==-1){
            perror("Erreur lors wait pid");
        }else{
            printf("Suis mort \n");
            sleep(5);
            kill(getpid(),SIGTERM);
        }
    }

    return EXIT_SUCCESS;
}

void traitement(int n){
    if(n==SIGUSR1){
        printf(" Le compteur est %d, et son PID est %d  voici mon pÃ¨re %d\n", compteur, getpid(),getgid());
        kill(getpid(),SIGTERM);
    }

    exit(EXIT_SUCCESS);
}